Title: Telemetry Device Driver
Author: Will Howe

This repo contains a personal project consisting of a simple linux device driver simulating navigation
telemetry values from a sensor on-board a satellite vehicle. The data from the device is read by a user
space process and publishes out over a message broker.

Pre-requistes
=========================

1. Install the kernel headers

`sudo dnf install kernel-devel kernel-headers`

Instructions for installing the kernel module
=========================

1. Build the module

`make`

2. Load the module

`sudo insmod mock_sensor.ko`

3. Check that it was loaded properly

`sudo dmesg | tail`
`lsmod | grep mock_sensor`

4. Access the sensor values

`cat /sys/kernel/mock_sensor/temperature`
`cat /sys/kernel/mock_sensor/humidity`

5. You can also write new values

`echo 30 | sudo tee /sys/kernel/mock_sensor/temperature`

6. Unload when done

`sudo rmmod mock_sensor`

Instructions for running the connector program
===============================================

1. Build

`cd connectors/poll_to_ipc && make`

2. Run the program for temperature

`./poll_to_ipc /temperature /sys/kernel/mock_sensor/temperature`

3. Run the program for humidity

`./poll_to_ipc /humidity /sys/kernel/mock_sensor/humidity`

NOTE: Messages are only added to the mq when the driver updates the sysfs file.

Instructions for running the Rust connectors
============================================

1. Build

`cargo run`

2. Run

`cargo run /temperature`

`cargo run /humidity`

3. Test

`cargo test`

Running a rabbit-mq broker
=================================================

# Run RabbitMQ with podman
podman run -d \
  --name rabbitmq \
  -p 5672:5672 \
  -p 15672:15672 \
  -e RABBITMQ_DEFAULT_USER=guest \
  -e RABBITMQ_DEFAULT_PASS=guest \
  rabbitmq:3-management

Inspect rabbitmq: http://localhost:15672/#/


TODO:

1. Unit test the Rust ipc to rabbit connector
2. Test ipc to rabbit and make sure it still works

3. ioctl implementation + Rust web endpoint
